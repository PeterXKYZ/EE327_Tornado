<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video thing</title>
</head>
<body>
    <h2>A live-ish Video?</h2>
    <button onclick="cam_on()">Camera On</button>
    <br>
    <button onclick="cam_off()">Camera Off</button>
    <br>
    <br>
    <img id="image" src="data:image/jpeg;base64," alt="hi there">

    <script>
        let ws = new WebSocket("ws://localhost:420/video");
        ws.onmessage = function(event) {
            // https://stackoverflow.com/questions/18650168/convert-blob-to-base64
            // the code below converts the binary blob message into base64 string,
            // which is then appended to the image source to be rendered as a jpeg.
            var reader = new FileReader();
            reader.readAsDataURL(event.data); 
            reader.onloadend = function() {
                var base64data = reader.result;
                
                // Need to remove some junk at the start of the message
                var realdata = base64data.substr(base64data.indexOf(',') + 1);  
                document.getElementById("image").src = "data:image/jpeg;base64," + realdata;
            }
            // document.getElementById("image").src = "test.jpg"
        };

        function cam_on() {
            ws.send("on");
        }

        function cam_off() {
            ws.send("off");
        }
    </script>
</body>
</html>